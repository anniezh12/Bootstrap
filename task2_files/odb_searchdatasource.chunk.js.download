(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([["odb_searchdatasource"],{1520:function(e,t,n){"use strict";var r="(?:[^\"'>]|\"[^\"]*\"|'[^']*')*",i=new RegExp("<(?:!--(?:(?:-*[^->])*--+|-?)|script\\b"+r+">[\\s\\S]*?</script\\s*|style\\b"+r+">[\\s\\S]*?</style\\s*|/?[a-z]"+r+")>","gi"),s=(function(){function e(){}e.getTextFromHtml=function(e){if(!e||"string"!=typeof e)return e;var t="";do{e=(t=e).replace(i,"")}while(t!==e);return e};e.decodeHtmlEntities=function(t){t=e.getTextFromHtml(t);var n=document.createElement("div");n.innerHTML=t;return n.textContent};return e})();t.e=s},2023:function(e,t,n){"use strict";n.d(t,"e",function(){return E});var r=n(0),i=n(105),s=n(227),o=n(143),u=n(17),a=n(142),f=n(3605),l=n(115),c=n(334),h=n(83),p=n(30),d=n(10),v=n(704),m=n(425),g=n(2018),y=n(34),b="https://substrate.office.com",w=(function(){function e(e,t){this._async=t.asyncType&&t.asyncType()||new o.e;var n=t.pageContext;this._tsMailbox={};this._scope=new s.e;this._mockIFrame=t.mockIFrame;this._identityDataSource=t.identityDataSource;this._oid="OID:"+n.aadUserId+"@"+n.aadTenantId;this._searchSession=t.searchSession;this._eventWindow=t.eventWindow}e.prototype.postTsData=function(e,t){var n=this,r=e.requestId||l.e.generate(),i=this._makeTsSignal(r);e.requestId=r;this._ensureSubstrateIframe().then(function(r){n._postData({dataRequest:e,qosName:t,signal:i},r)}).catch(function(){i.error({status:-1})});return i.getPromise()};e.prototype._postData=function(e,t){var n=this,i=e.dataRequest,s=e.qosName,o=e.signal;return this._identityDataSource.getSubstrateToken(v.e.STI).then(function(e){var u=e.accessToken,a=i.requestId,l=Object(r.__assign)(Object(r.__assign)({},i),{requestId:a,token:u,prefix:i.prefix||"",additionalInfo:Object(r.__assign)(Object(r.__assign)({},i.additionalInfo),{scenario:i.scenarioName,entitytypes:"file"}),headers:Object(r.__assign)(Object(r.__assign)({},i.headers),{accept:"application/json","Client-request-id":a,"Client-Session-Id":n._searchSession,"X-AnchorMailbox":n._oid,"X-Client-Language":c.e.language,"X-Client-LocalTime":Object(f.e)((new Date).toString(),!0)})});n._tsMailbox[a]={responseSignal:o,qosEvent:new h.e({name:s}),accessToken:u,startTime:Date.now(),timeoutId:n._makeTimeoutId(a)};t.contentWindow.postMessage(JSON.stringify(l),b)})};e.prototype._createIFrame=function(){var e=document.createElement("iframe");e.id="tsProxy";e.src="https://substrate.office.com/search/api/v2/resources";e.style.display="none";document.body.insertBefore(e,document.body.firstChild);this._scope.attach({dispose:function(){e.remove()}});return e};e.prototype._ensureSubstrateIframe=function(){var e=this;if(!this._iFramePromise){this._iFrameLoadedQos=new h.e({name:"TsProxyInitialize"});this._iFramePromise=new u.n(function(t,n){var r=new i.e(null),s=e._mockIFrame||e._createIFrame();e._iFrameLoadTimeout=window.setTimeout(function(){e._iFrameLoadedQos.end({resultType:p.e.Failure});n()},15e3);r.on(e._eventWindow||window,"message",function(n){if(n.origin===b)if(n.data&&"loaded"===n.data){window.clearTimeout(e._iFrameLoadTimeout);e._iFrameLoadedQos.end({resultType:p.e.Success});t(s)}else e._tsDataListener(n.data)})})}return this._iFramePromise};e.prototype._tsDataListener=function(e){var t,n;try{t=JSON.parse(e);n=JSON.parse(t.qfResponse)}catch(e){return}finally{var r=void 0,i=void 0;if(t&&(r=t.requestId)&&(i=this._tsMailbox[r])){this._async.clearTimeout(i.timeoutId);var s=t.statusCode;if(200===s&&n){i.responseSignal.complete(n);i.qosEvent.end({resultType:p.e.Success,resultCode:"200",extraData:{traceId:n.Instrumentation.TraceId,requestId:r}})}else{i.qosEvent.end({resultType:p.e.Failure,resultCode:s.toString(),startTimeOverride:i.startTime,extraData:{traceId:n&&n.Instrumentation.TraceId,requestId:r,response:t.qfResponse}});i.responseSignal.error({status:s,response:n})}delete this._tsMailbox[r]}}};e.prototype._makeTsSignal=function(e){var t=this;return new a.e(function(){var n;if(n=t._tsMailbox[e]){t._async.clearTimeout(n.timeoutId);n.qosEvent.end({resultType:p.e.ExpectedFailure,resultCode:"Canceled",extraData:{requestId:e}});delete t._tsMailbox[e]}})};e.prototype._makeTimeoutId=function(e){var t=this;return this._async.setTimeout(function(){var n;if(n=t._tsMailbox[e]){n.qosEvent.end({resultType:p.e.Failure,resultCode:"Timeout",extraData:{bufferLength:Object.keys(t._tsMailbox).length,requestId:e}});n.responseSignal.error({status:400});delete t._tsMailbox[e]}},6e4)};e.dependencies={eventWindow:void 0,mockIFrame:void 0,identityDataSource:m.e,pageContext:y.h,searchSession:g.e};return e})(),E=Object(d.s)("TsDataRequestor",w)},2211:function(e,t,n){"use strict";n.d(t,"e",function(){return j});var r=n(0),i=n(3605),s=n(769),o=n(89),u=n(2001),a=n(1949),f=n(1885),l=n(34),c=n(479),h=n(115),p=n(1324),d=n(1253),v=n(141),m=n(1448),g=n(40),y=n(782),b=n(1359),w=n(2336),E=n(1458),S=n(1701),x=n(127),T=n(1298),N=n(1950),C=n(1702),k=n(10),L=n(1740),A=n(15),O=n(21),M=n(1351),_=n(65),D=n(333),P="OneNote.Notebook",H=(function(){function e(e,t){void 0===e&&(e={});this._pageContext=t.pageContext;this._urlDataSource=t.urlDataSource;this._microServiceDataSource=t.microServiceDataSource;this._vroomUrlHelper=t.vroomUrlHelper;this._itemUrlHelper=t.itemUrlHelper;var n=t.GridPreviewHelpers,r=void 0===n?u:n,i=t.mayInferListUrl,s=void 0!==i&&i,o=t.engagement;this._mayInferListUrl=s;this._gridPreviewHelpersType=r;this._externalFacetForItemsInOtherLibrary=!A.e.isActivated("E56E0EC3-55F7-4D9C-9A55-D7523418F3DD","09/24/2019","External facet for search items in different library");this._isFallbackPathEnabled=!A.e.isActivated("7E9E1FFD-7275-44CB-A1FC-98FE17B8368A","10/30/2019","fallback to set path ");this._engagement=o}e.prototype.processItemResult=function(e,t){var n,i=t.requestKey,s=void 0===i?"":i,o=t.searchInstrumentationUrl,u=t.tsTraceId,l=t.getThumbnailByUrl,v=void 0!==l&&l,S=t.useRequestKeyForParentKey,N=void 0!==S&&S,C=t.observer,k=t.webAbsoluteUrl,A=t.calculateDisplayPath,O=void 0!==A&&A,M=t.searchItemFullPath,_=t.queryType,D=void 0===_?this._urlDataSource.getQueryType(this._urlDataSource.getKeyParams(s)):_,P=e.ParentLink;P=P&&P.replace("/Forms/All.aspx","");var H=e.Filename,j=e.Path;P&&H&&(j&&j.indexOf("/Forms/DispForm.aspx?ID=")>=0||this._isFallbackPathEnabled&&!j)&&(j=P+"/"+H);var F=new x.e(e.SPSiteURL),I=new x.e(j),q=""+F.path,R=this._getKey({path:j,uniqueId:e.UniqueID,entryId:e.ID,siteUrl:q}),U={key:R},z=e[".spResourceUrl"];if(z){var W=this._vroomUrlHelper.getUrlParts(z);U.graph={driveId:W.driveId,itemId:W.itemId}}var X,V=B(e);X=I.segments.slice().reverse()[1];if(O){var $=this._getDisplayPathIcon(e,M,I,k);U.displayPath={segments:$.displayPath}}var J=H||e.Title,K=V!==e.FileExtension,Q=this._getFileExtension(e);U.extension=Q;U.queryType=D;U.displayType=D;var G,Y=e.UniqueID&&h.e.normalizeLower(e.UniqueID),Z=e.EditorOWSUSER,ee=Z&&Object(f.getUserFromOwsString)(Z);U.properties={uniqueId:T.e.optional(Y),ID:e.ListItemID,listId:e.ListID,path:j,editorName:T.e.optional(ee&&[ee])};U.queryType===g.e.SharedByMe&&".one"===Q&&(U.location=X);if(P&&q&&!K&&!N){var te=""+I.authority+I.segments.slice(0,-1).join("/");G=this._getKey({path:te,siteUrl:q})}else G=s;U.parentKey=G;U.parentLink=P;var ne=this._itemUrlHelper.getItemUrlParts(R);U.id=e.FileRef||ne.serverRelativeItemUrl;K||(U.location=X);U.size=e.Size;U.caption=e.Description;U.creatorName=e.CreatedBy;e.Created&&(U.dateCreated=this._getDateString(e.Created));U.editorName=ee?ee.title:e.ModifiedBy;e.LastModifiedTime&&(U.dateModified=this._getDateString(e.LastModifiedTime));var re,ie,se=e.Edges&&e.Edges.filter(function(e){return 1036===e.Properties.Action})[0];se&&se.Properties&&(re=se.Properties.BlobContent.ActorCount)&&(U.viewersCount=parseInt(re,10));U.editorsCount=e.EditorsCount;if(e.PictureURL){U.editorProfilePicUrl=e.PictureURL;U.editorProfileUrl=e.PicturePath;U.editorName=e.PreferredName}U.defaultSubText=a.e(e.ModifiedBy);U.name=J;U.displayName=J;if((e.IsContainer||a.s(e.ContentTypeId))&&"one"!==V){ie=d.e.Folder;U.folder={};j&&0!==j.indexOf(this._pageContext.webAbsoluteUrl)&&(U.openUrl=j)}else{ie=p.r(V);"audio"===p.t(Q)&&(ie=d.e.Media);U.openUrl=e.ServerRedirectedURL||e.LinkingUrl||j}var oe=this._getPdfConversionFacet(e);oe&&(U.pdfConversion=oe);Object(c.isFeatureEnabled)(c.UseWebPdfViewer)&&("pdf"===V||oe)&&(ie=d.e.Media);var ue=this._get3dFacet(e);if(ue){U.model3d=ue;ie=d.e.Media}U.sharingRole=0;var ae=e.SharedWithDetails?b.e.Shared:b.e.Private;U.sharingType=ae;var fe,le=Object(w.t)("."+V);if((le||"ai"===V||"eps"===V||"psd"===V)&&this._microServiceDataSource.getThumbnail({fileExtension:Q,item:e,itemKey:R})){le&&(U.photo={width:0,height:0});ie=d.e.Media}if(Object(L.e)(Q)){var ce=this._microServiceDataSource.getHtmlConversionUrl({fileExtension:this._getFileExtension(e),item:e});if(ce){ie=d.e.Media;U.htmlConversion={url:ce}}}else".svg"===Q&&(U.htmlConversion={});if(".ts"===Q&&e.Size<1<<19){fe="text/typescript";ie=d.e.File}if(ie===d.e.Media){var he=p.t(V);he===p.s?U.video={width:0,height:0,fourCC:"H264"}:he===p.i?this._pageContext.isSPO?U.photo={width:0,height:0}:ie=d.e.File:"audio"===he&&(U.audio={})}U.iconName=p.n({extension:Q,sharingType:ae,type:ie,textEditorMimeType:fe});U.type=ie;V&&(U.appMap=m.e[V]);D===g.e.SharedWithMe&&"pdf"===V&&(U.openUrl=j);U.thumbnail=this._getThumbnail(R,e,v);U.tsTraceId=u;U.tsReferenceId=e.TsReferenceId;U.urls=Object(r.__assign)(Object(r.__assign)({},this._getVideoUrl(e)),((n={})[E.t.downloadAsZip]=this._microServiceDataSource.getDownloadAsZipUrl(e),n[E.t.itemUrl]=z,n[E.t[E.t.download]]=T.e.optional(e.SPWebUrl?e.SPWebUrl+"/_layouts/15/download.aspx?SourceUrl="+j:void 0),n[E.t[E.t.bingClickInstrumentation]]=T.e.optional(o&&Object(y.e)(D)?o:void 0),n));U.itemFromServer=e;U.isPlaceholder=!1;this._externalFacetForItemsInOtherLibrary&&Object(y.e)(D)&&j&&j.indexOf(this._pageContext.webAbsoluteUrl)<0&&(U.external={});var pe=[new T.t(R).succeed({item:U})];G&&pe.push(new T.t(G).succeed({item:{key:G,type:T.e.backup(d.e.Folder)}}));C.update(pe);return{key:R}};e.prototype._getDateString=function(e){var t=Object(i.t)(e);return Object(s.n)(t)};e.prototype._getKey=function(e){var t,n=e.path,r=e.uniqueId,i=e.entryId,s=e.siteUrl,o=this._itemUrlHelper.getUrlParts({path:n,webUrl:s,mayInferListUrl:this._mayInferListUrl}),u=["search"];void 0!==r&&u.push(r);void 0!==i&&u.push(""+i);return this._urlDataSource.getKey(((t={}).id=o.serverRelativeItemUrl,t.u=u.join("|"),t.listurl=o.normalizedListUrl,t))};e.prototype._getFileExtension=function(e){var t=B(e);return t&&"."+t||""};e.prototype._getPdfConversionFacet=function(e){var t=this._microServiceDataSource.getPdfConversionUrl({fileExtension:this._getFileExtension(e),item:e});if(t)return{url:t}};e.prototype._get3dFacet=function(e){if(this._pageContext.isSPO){var t=this._getFileExtension(e),n=this._microServiceDataSource.getFbxConversionUrl({fileExtension:t,item:e}),r=C.t(t);if(n||r)return{canConvert:!r,canRenderNative:r,conversionUrl:n&&n.replace("/bxf?","/glb?")}}};e.prototype._getThumbnail=function(e,t,n){var r=this._microServiceDataSource.getThumbnail({fileExtension:this._getFileExtension(t),item:t,itemKey:e});if(r)return r;var i=t.SecondaryFileExtension;return i&&this._pageContext.isSPO&&Object(w.e)("."+i.toLowerCase())?this._gridPreviewHelpersType.previewImageUrl(t,t.SPWebUrl||this._pageContext.webAbsoluteUrl,this._pageContext,!!t.Edges||n):void 0};e.prototype._getDisplayPathIcon=function(e,t,n,r){var i,s=e.SPWebUrl?new x.e(e.SPWebUrl):void 0,o=t?new x.e(t):void 0;if(o&&o.segments){var u=0===n.value.indexOf(o.value)&&n.value.length>o.value.length&&"/"===n.value.charAt(o.value.length);u?i=n.segments.slice(o.segments.length-1,-1):!u&&s&&s.segments?i=n.segments.slice(s.segments.length-1,-1):this._engagement.logData({name:"GetDisplayPathIcon.InvalidUrls",isIntentional:!1})}else!o&&s&&s.segments&&n&&n.segments&&n.segments.length>=s.segments.length?e.SPWebUrl===r?i=n.segments.slice(s.segments.length,-1):e.SiteTemplateId===_.t.mySite&&e.SiteTitle?(i=n.segments.slice(s.segments.length,-1)).unshift(O.format(M.e.OtherOneDrive,e.SiteTitle)):i=n.segments.slice(s.segments.length-1,-1):this._engagement.logData({name:"GetDisplayPathIcon.InvalidUrls",isIntentional:!1});return{displayPath:i}};e.prototype._getVideoUrl=function(e){var t,n=this._microServiceDataSource.getVideoUrl({fileExtension:this._getFileExtension(e),item:e});return(t={})[E.t.video]=n,t};e.dependencies={pageContext:l.h,urlDataSource:o.me,microServiceDataSource:S.e,vroomUrlHelper:N.e,itemUrlHelper:v.n,engagement:D.e};return e})();function B(e){var t=e.SecondaryFileExtension,n=e.ContentTypeId,r=e.ServerRedirectedURL;if(!t){var i=e.ProgId===P,s=a.s(n)&&r&&-1!==r.toLowerCase().indexOf("wopiframe.aspx?");(i||s)&&(t="one")}return t}var j=Object(k.s)("ItemResultProcessor_1",H)},2381:function(e,t,n){"use strict";n.d(t,"t",function(){return d});n.d(t,"e",function(){return v});n.d(t,"n",function(){return m});n.d(t,"r",function(){return b});var r=n(246),i=n(8),s=n(10),o=n(480),u=n(2018),a=n(34),f=n(479),l='[\\.\\;\\,\\s-_\\(\\)\\/\\"\\u201c\\xab\\!\\&\\+\\¤\\<\\>\\@\\+\\=]',c=new RegExp(l,"g"),h=new RegExp("^"+l+"+|"+l+"+$|"+l+"+(?="+l+")","g"),p=["Path","SecondaryFileExtension","FileExtension","ParentLink","Size","Description","CreatedBy","Created","ModifiedBy","LastModifiedTime","IsContainer","Filename","Title","LinkingUrl","SharedWithDetails","ListID","SiteID","WebId","UniqueID","piPageImpression","piPageImpressionBlockType","piSearchResultId",".mediaBaseUrl",".spResourceUrl",".callerStack",".correlationId",".thumbnailUrl",".videoManifestUrl",".pdfConversionUrl"];Object(f.isFeatureEnabled)(f.ODBSearchLocationColumn)&&p.push("SPWebUrl","SiteTemplateId","SiteTitle");var d="QueryBoxSkyDrive",v="FullResults",m=new i.t({name:"SearchService.isOLSQueryEnabled",factory:new i.e(!1)}),g=(function(){function e(e,t){void 0===e&&(e={});this._isOLSQueryEnabled=t.isOLSQueryEnabled;this._dataRequestor=new t.dataRequestorType({});this._pageContext=t.pageContext;this._searchSession=t.searchSession}e.prototype.query=function(e,t){void 0===t&&(t={});var n=t.pageSize,i=void 0===n?50:n,s=t.startRow,o=void 0===s?0:s,u=t.qosName,a=t.clientType,f=void 0===a?"OneDriveWeb":a,l=t.clientFunction,d=t.clientFunctionDetails,m=t.timeout,g=t.filterQuery,b=t.selectProperties,w=void 0===b?p:b,E='(({searchTerms}) OR ({searchTerms}*)) (path:"'+this._pageContext.webAbsoluteUrl.replace("'","''")+'" OR SharedWithUsersOWSUser:{User.EncodedLoginName}) (ContentTypeId:0x010100* OR ContentTypeId:0x012000*) -ContentClass=STS_List_* -ContentClass=STS_Site -ContentClass=STS_Web -ContentClass=STS_ListItem_544 -ContentClass=STS_ListItem_550',S=this._isOLSQueryEnabled,x=S?e:(function(e){var t;if(e){c.test(e)&&(e=(n=e,n.replace(h,"").split(c)).join(" "));e=e.replace(/\'/g,"''");t=e.lastIndexOf("*")===e.length-1||e.lastIndexOf(" ")===e.length-1?(function(e){return e.replace(/^\s+|\s+$|\s+(?=\s)/g,"")})(e):"(("+e+") OR ("+e+"*))"}else t="*";var n;return t})(e);g&&(x+=" AND "+g);var T={clientType:"'"+f+"'",EnableQueryRules:!1,queryTemplate:"'"+E+"'",querytext:"'"+x+"'",rowLimit:i,culture:this._pageContext.currentLanguage,startRow:o,properties:"'"+y({ClientFunction:l,ClientFunctionDetails:d})+"'",selectProperties:"'"+w.join(",")+"'"};S&&l===v&&(T.useOLSQuery=1);T.OLSQuerySession="'"+this._searchSession+"'";var N=this._pageContext.webAbsoluteUrl+"/_api/search/query?"+r.t(T);return this._dataRequestor.getData({url:N,method:"GET",qosName:u||"Odb.SearchService.query",timeout:m,noRedirect:!0}).then(function(e){return e.d.query})};e.prototype.getSearchResultsForUrl=function(e,t){e=this._pageContext.webAbsoluteUrl+e;return this._dataRequestor.getData({url:e,method:"GET",qosName:t,noRedirect:!0}).then(function(e){return e.d.query})};e.prototype.getSearchInstrumentationUrl=function(e){var t,n=e.itemFromServer.piSearchResultId,i=e.pageImpression,s=e.pageImpressionBlockType,o=e.index;if(n){var u={pageInfo:"'"+i+"'",clickType:"'0'",subResultIndex:o,clickedResultId:"'"+n+"'",blockType:s};t=this._pageContext.webAbsoluteUrl+"/_api/search/recordpageclick?"+r.t(u)}return t};e.dependencies={isOLSQueryEnabled:m,dataRequestorType:o.t,pageContext:a.h,searchSession:u.e};return e})();function y(e){var t=[];for(var n in e){e[n]&&t.push(n+":"+e[n])}return t.join(",")}var b=Object(s.s)("SearchService",g)},2414:function(e,t,n){"use strict";n.r(t);var r,i,s,o=n(0),u=n(3605),a=n(115),f=n(10),l=n(194),c=Object(l.e)({eventName:"sss_clientdatasource,",isEventTypePrefixingDisabled:!0,shortEventName:"sss_clientdatasource"},{traceid:{isPrefixingDisabled:!0,type:1},userId:{isPrefixingDisabled:!0,type:1},conversationId:{isPrefixingDisabled:!0,type:1},impressionType:{isPrefixingDisabled:!0,type:1},scenarioName:{isPrefixingDisabled:!0,type:1},localtime:{isPrefixingDisabled:!0,type:1},version:{isPrefixingDisabled:!0,type:2},logicalId:{isPrefixingDisabled:!0,type:1},providerName:{isPrefixingDisabled:!0,type:1},results:{isPrefixingDisabled:!0,type:1}}),h=Object(l.e)({eventName:"sss_responsereceived,",isEventTypePrefixingDisabled:!0,shortEventName:"sss_responsereceived"},{traceid:{isPrefixingDisabled:!0,type:1},latency:{isPrefixingDisabled:!0,type:2},status:{isPrefixingDisabled:!0,type:2},rendered:{isPrefixingDisabled:!0,type:2},renderinglatency:{isPrefixingDisabled:!0,type:2},version:{isPrefixingDisabled:!0,type:2},providerName:{isPrefixingDisabled:!0,type:1}}),p=Object(l.e)({eventName:"sss_resultsrendered,",isEventTypePrefixingDisabled:!0,shortEventName:"sss_resultsrendered"},{traceid:{isPrefixingDisabled:!0,type:1},e2eLatency:{isPrefixingDisabled:!0,type:2},version:{isPrefixingDisabled:!0,type:2},logicalId:{isPrefixingDisabled:!0,type:1}}),d=Object(l.e)({eventName:"sss_searchactions,",isEventTypePrefixingDisabled:!0,shortEventName:"sss_searchactions"},{traceid:{isPrefixingDisabled:!0,type:1},eventtype:{isPrefixingDisabled:!0,type:1},localtime:{isPrefixingDisabled:!0,type:1}}),v=Object(l.e)({eventName:"sss_searchentityactions,",isEventTypePrefixingDisabled:!0,shortEventName:"sss_searchentityactions"},{traceid:{isPrefixingDisabled:!0,type:1},eventtype:{isPrefixingDisabled:!0,type:1},id:{isPrefixingDisabled:!0,type:1},localtime:{isPrefixingDisabled:!0,type:1},version:{isPrefixingDisabled:!0,type:2},logicalId:{isPrefixingDisabled:!0,type:1},metadata:{isPrefixingDisabled:!0,type:1}}),m=(function(){function e(){}e.prototype.logEvent=function(e){switch(e.name){case"sss_responsereceived":h.logData(e);return;case"sss_searchactions":d.logData(e);return;case"sss_searchentityactions":v.logData(e);return;case"sss_clientdatasource":c.logData(e);return;case"sss_resultsrendered":p.logData(e);return;default:return}};e.dependencies={};return e})(),g=Object(f.s)("TsInstrumentationDataSource",m),y=n(1113),b=n(2023),w=(function(e){Object(o.__extends)(t,e);function t(t,n){var r=e.call(this,t,n)||this;r._tsDataRequestor=n.tsDataRequestor;r.eventsBatch={};return r}t.prototype.logEvent=function(e){var t=e.traceid,n=this.eventsBatch;0===Object.keys(n).length&&this.async.setTimeout(this._postEvents,5e3);n[t]=n[t]||[];n[t].push({Name:e.name.substring(4),Attributes:Object.keys(e).filter(function(t){return"traceid"!==t&&"name"!==t&&void 0!==e[t]}).map(function(t){return{Key:t,Value:e[t].toString()}})})};t.prototype._postEvents=function(){var e=this,t=Object.keys(this.eventsBatch).map(function(t){return{Key:t,Value:e.eventsBatch[t]}});this.eventsBatch={};var n=JSON.stringify(t);this._createPostEventsPromise(n,"Odb.Search.3S.events").catch(function(){e._createPostEventsPromise(n,"Odb.Search.3S.eventsRetry").catch()})};t.prototype._createPostEventsPromise=function(e,t){var n=a.e.generate();return this._tsDataRequestor.postTsData({requestId:n,action:"logevents",prefix:e,scenarioName:"onedriveweb"},t)};t.dependencies=Object(o.__assign)(Object(o.__assign)({},y.default.dependencies),{tsDataRequestor:b.e});return t})(y.default),E=Object(f.s)("SubstrateSearchEventsDataSource",w),S=n(287),x=n(479);n.d(t,"ITsSearchActionEventType",function(){return r});n.d(t,"TsImpressionType",function(){return i});n.d(t,"TsClientDataSourceResultType",function(){return s});n.d(t,"TsInstrumentationProvider",function(){return N});n.d(t,"resourceKey",function(){return C});(function(e){e.entityClicked="EntityClicked";e.entityActionTaken="EntityActionTaken";e.preview="PreviewOpen"})(r||(r={}));(function(e){e.suggestions="Suggestions";e.query="Query"})(i||(i={}));(function(e){e.file="File";e.folder="Folder"})(s||(s={}));function T(e,t){for(var n=0,r=e.length;n<r;n++)if(t(e[n]))return n;return-1}var N=(function(){function e(e,t){Object(x.isFeatureEnabled)(x.Use3SEventsAPI)?this._instrumentationDataSource=t.eventsDataSource:this._instrumentationDataSource=t.instrumentationDataSource;this._responseQueue=[];this._resultsRenderedQueue=[];this._lastSubmittedConversationId=a.e.generate();this._searchBoxConfig=t.searchBoxConfig}e.prototype.receivedResponse=function(e,t,n,r){n?this._instrumentationDataSource.logEvent({name:"sss_responsereceived",traceid:e,status:200,latency:Math.round(t),version:2,providerName:r}):this._responseQueue.push({name:"sss_responsereceived",traceid:e,latency:Math.round(t),status:200})};e.prototype.receivedError=function(e,t,n,r){void 0===n&&(n=400);r?this._instrumentationDataSource.logEvent({name:"sss_responsereceived",traceid:e,latency:Math.round(t),status:n,version:2}):this._instrumentationDataSource.logEvent({name:"sss_responsereceived",traceid:e,latency:Math.round(t),status:n,rendered:0})};e.prototype.renderedResults=function(e,t){var n=this,r=this._responseQueue,i=T(r,function(t){return t.traceid===e});if(i>-1){r.splice(0,i).forEach(function(e){n._instrumentationDataSource.logEvent(Object(o.__assign)(Object(o.__assign)({},e),{rendered:0}))});this._instrumentationDataSource.logEvent(Object(o.__assign)(Object(o.__assign)({},r.shift()),{rendered:1,renderinglatency:Math.round(t)}))}};e.prototype.didSearch=function(e){for(var t=this._responseQueue;t.length;)this._instrumentationDataSource.logEvent(Object(o.__assign)(Object(o.__assign)({},t.shift()),{rendered:0}));this._instrumentationDataSource.logEvent({name:"sss_searchactions",traceid:e,eventtype:"searchdone",localtime:this._getLocalISODateString()})};e.prototype.selectedEntity=function(e,t){this.logSearchEntityAction("entityclicked",e,t)};e.prototype.userExecuteActionOnEntity=function(e,t,n,r){var i=this._mapSearchAction(n);i&&this.logSearchEntityAction(i.eventType,e,t,2,r,i.metadata)};e.prototype.logClientDataSource=function(e){this._instrumentationDataSource.logEvent(Object(o.__assign)(Object(o.__assign)({},e),{name:"sss_clientdatasource",localtime:this._getLocalISODateString(),version:2,results:JSON.stringify(e.results),userId:this._removeDomainFromUserId(e.userId)}))};e.prototype.queueResultsRendered=function(e,t,n){this._resultsRenderedQueue.push({name:"sss_resultsrendered",traceid:e,logicalId:n,e2eLatency:t,version:2})};e.prototype.resultRendered=function(e){var t=this,n=this._resultsRenderedQueue,r=performance.now();if(0!==n.length){var i=e.tsTraceId,s=e.itemFromServer;!i&&s&&(i=s.TsTraceId);if(i){var o=T(n,function(e){return e.traceid===i});if(o>-1){n.splice(0,o).forEach(function(e){t._instrumentationDataSource.logEvent({name:"sss_resultsrendered",traceid:e.traceid,logicalId:e.logicalId,version:2})});var u=n.shift();this._instrumentationDataSource.logEvent({name:"sss_resultsrendered",traceid:u.traceid,logicalId:u.logicalId,version:2,e2eLatency:Math.round(r-u.e2eLatency)})}}}};e.prototype.setLastSubmittedConversationId=function(e){this._lastSubmittedConversationId=e};e.prototype.getLastSubmittedConversationId=function(){var e=this._searchBoxConfig&&this._searchBoxConfig.getInstrumenter();return e&&e.conversationManager.getLastSubmittedConversation().conversationId||this._lastSubmittedConversationId};e.prototype.logSearchEntityAction=function(e,t,n,r,i,s){this._instrumentationDataSource.logEvent({name:"sss_searchentityactions",traceid:t,eventtype:e,id:n,localtime:this._getLocalISODateString(),version:r,logicalId:i,metadata:s})};e.prototype._getLocalISODateString=function(){return Object(u.e)((new Date).toString(),!0)};e.prototype._mapSearchAction=function(e){switch(e){case"OpenInOfficeClient":case"OpenInDesktop":return{eventType:r.entityClicked,metadata:JSON.stringify({EntityClickDetails:"OpenInClient"})};case"OpenInOfficeOnline":case"OpenInTextEditor":case"OpenPdfInBrowserAction":return{eventType:r.entityClicked,metadata:JSON.stringify({EntityClickDetails:"OpenInViewer"})};case"OpenShortcut":case"Open.File":case"Open.Media":case"Open":case"ExternalNavigate":return{eventType:r.entityClicked,metadata:JSON.stringify({EntityClickDetails:e})};case"Preview":return{eventType:r.preview};case"ShowShareAction":case"GetLink":case"ShareByLink":return{eventType:r.entityActionTaken,metadata:JSON.stringify({EntityActionTakenType:"Share"})};case"ViewInFolderAction":return{eventType:r.entityActionTaken,metadata:JSON.stringify({EntityActionTakenType:"ViewInFolder"})};default:return}};e.prototype._removeDomainFromUserId=function(e){if(!e)return e;var t=e.indexOf("@");return t>-1?e.substring(0,t):e};e.dependencies={instrumentationDataSource:g,searchBoxConfig:S.e.optional,eventsDataSource:E};return e})(),C=Object(f.s)("TsInstrumentationProvider",N)},3136:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(26),s=n(34),o=n(1449),u=n(1113),a=n(275),f=n(17),l=n(115),c=n(264),h=n(103),p=n(10),d=n(21),v=n(15),m=n(1351),g=n(2211),y=n(1885),b=n(2381),w=n(1298),E=n(2023),S=n(40),x=n(2271),T=n(1253),N=n(141),C=n(1),k=n(8),L=n(984),A=new k.t({name:"DisplayPathRenderer",factory:new k.e(function(e){var t=e.item,n=t.displayPath&&t.displayPath.segments||[],r=Object(L.t)(n);return C.createElement("span",{title:n.join(">")},r)})}),O=n(488),M=n(266),_=n(1555),D=n(1279),P=n(2414),H=n(1827),B=n(89),j=n(479),F=n(1949),I=n(782);n.d(t,"dateFilterMap",function(){return z});n.d(t,"searchFilterExtensionMap",function(){return W});n.d(t,"getDays",function(){return X});n.d(t,"resourceKey",function(){return $});var q="SharePoint",R="OneDriveBusiness",U=["Author","Created","FileExtension","Filename","LastModifiedTime","ModifiedBy","Size","Title","ListID","SiteId","UniqueID","WebId","IsContainer","LinkingUrl","OriginalPath","ParentLink","Path","SecondaryFileExtension","SharedWithDetails","SPWebUrl","ServerRedirectedURL",".spResourceUrl","ContentTypeId","Description","EditorOWSUSER","Title","ProgId","SiteTemplateId","SiteTitle"],z={2:"last month",3:"this week",4:"yesterday",5:"today"},W={word:["doc","dot","odt"],excel:["xls","ods"],powerpoint:["ppt","pps","odp"],onenote:["one","onepkg","onetoc2","notebook"],media:["jpg","mp3","png","mpg","wmv","mp4","jpeg"],zip:["zip","gz","7zip","rar"],text:["txt","log"],pdf:["pdf"]};function X(e){switch(e){case o.e.last3Months:return 90;case o.e.last30Days:return 30;case o.e.last7Days:return 7;case o.e.yesterday:return 2;case o.e.today:return 1}}var V=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});var r=e.call(this,t,n)||this;r._cvid=l.e.generate();r._pageContext=n.pageContext;r._urlDataSource=n.urlDataSource;r._itemUrlHelper=n.itemUrlHelper;r._itemsStore=n.itemsStore;r._isOLSQueryEnabled=n.isOLSQueryEnabled;r._itemResultProcessor=n.itemResultProcessor;r._searchService=n.searchService;r._tsDataRequestor=n.tsDataRequestor;r._tsInstrumentationProvider=n.tsInstrumentationProvider;r._itemTaskObserverType=n.itemTaskObserverType;r._webDataSource=n.webDataSource;var i=n.SearchRest,s=void 0===i?y:i;r._searchRestType=s;r._pageContext.substrateOneDriveDisabled||(r._useTsQuery=Object(j.isFeatureEnabled)(j.UseTsQuery));r._isNon3SProviderLoggingEnabled=!v.e.isActivated("E30BC4D8-A613-4721-8DE1-185874D065A8","05/14/2019","Send 3S signals for non 3S query providers");r._logResultsRenderedEnabled=Object(j.isFeatureEnabled)(j.Send3SResultsRenderedSignal);r._useConversationIdFromInstrumentation=!v.e.isActivated("F0524DDA-E90F-4D61-998F-3807689BE619","06/25/2019","Use conversationId from instrumentation");r._useSubstrateSearchV2=Object(j.isFeatureEnabled)(j.UseSubstrateSearchV2API);r._odbSearchTenantScopeEnabled=!1;if(Object(j.isFeatureEnabled)(j.ODBSearchTenantScope)){var o=new c.t({name:"ODBSearchTenantScope",startDate:"12/2/2019",version:c.e.v2});r._odbSearchTenantScopeEnabled=o.IsExperimentOn()}r._handle3SErrorsEnabled=!v.e.isActivated("5A30A184-5AE7-42F0-9615-E44831928F7B","10/30/2019","Handle 3S response errors");return r}t.prototype.getItem=function(e){var t=this;return this._isCurrentUserODB().then(function(n){return t._getItem(e,n)})};t.prototype.getSearchResultSetItem=function(e){var t=this;return this._isCurrentUserODB().then(function(n){if(n&&t._useTsQuery){var r=e.query,i=e.parentKey,s=e.startRow,o={parentKey:i},u={query:r,queryPath:t._getQueryPath(i),startRow:s,filterQuery:t._getFilterQuery(o),context:o,conversationId:t._useConversationIdFromInstrumentation&&t._tsInstrumentationProvider.getLastSubmittedConversationId()||t._cvid};return t._getTsResponse(u).then(function(e){return e.EntitySets[0].ResultSets[0]})}return{}})};t.prototype._getTsResponse=function(e){var t,n=this,i=e.query,s=e.startRow,o=e.context,u=e.queryPath,a=e.conversationId,c=e.filterQuery,h=performance.now(),p=l.e.generate(),d=this._useSubstrateSearchV2?p:void 0,v=!!u&&this._urlDataSource.isItemCrossList(o.parentKey);if(this._useSubstrateSearchV2){var m=(t={EntityRequests:[{EntityType:"File",ContentSources:v?[q]:[R],From:s,Size:25,Query:{QueryString:this._getQueryStringWithPathAndFilter(u,i,this._getSearchItemFullPath(o.parentKey),c)},Sort:[{Score:"Desc"}]}],TimeZone:"UTC",Cvid:a,Scenario:{Name:"onedriveweb"},LogicalId:d}).EntityRequests[0];if(this._odbSearchTenantScopeEnabled&&!u){m.ContentSources.push(q);m.ResultsMerge={Type:"Interleaved"};m.Query.QueryTemplate='({searchterms}) (NOT (Title:OneNote_DeletedPages OR Title:OneNote_RecycleBin) AND NOT SecondaryFileExtension:onetoc2 AND NOT FileExtension:vtt AND NOT ContentClass:ExternalLink AND NOT (ContentClass:STS_List_DocumentLibrary AND SiteTemplateId:21) AND NOT ((filetype:aspx OR filetype:htm OR filetype:mhtml)) AND isExternalContent:False AND (ContentClass:STS_ListItem_MySiteDocumentLibrary OR ContentClass:STS_ListItem_DocumentLibrary)) AND NOT (ContentTypeId:0x0101009D1CB255DA76424F860D91F20E6C4118* AND PromotedState:2) AND NOT Path:"'+this._pageContext.webAbsoluteUrl+'"';m.Sort=[{Field:"PersonalScore",SortDirection:"Desc"}]}m.ContentSources.indexOf(q)>-1&&(m.Fields=U)}else t={EntityRequests:[{EntityType:"File",Provenances:[R],From:s,Size:25,Query:{QueryString:i+(c?" AND "+c:"")},Sort:[{Score:"Desc"}],PropertySet:"ProvenanceOptimized"}],TimeZone:"UTC",Cvid:a,Scenario:{Name:"onedriveweb"}};var g={textDecorations:1};u&&!v&&(g=Object(r.__assign)(Object(r.__assign)({},g),{setflight:"nuowoflight"}));return this._tsDataRequestor.postTsData({requestId:p,action:this._useSubstrateSearchV2?"queryv2":"query",cvid:a,prefix:JSON.stringify(t),scenarioName:"onedriveweb",headers:{"Content-Type":"application/json"},additionalInfo:g},"Odb.Search.3S.getItems").then(function(e){if(e.Instrumentation){var t=e.Instrumentation.TraceId,r=performance.now();n._tsInstrumentationProvider.receivedResponse(t,r-h,!0);n._queueResultsRenderedEvent(t,h,d)}return e}).catch(function(e){var t=performance.now(),r=f.n.isCanceled(e)?408:e.status;n._tsInstrumentationProvider.receivedError(p,t-h,r,!0);throw e})};t.prototype._isCurrentUserODB=function(){var e=this,t=this._webDataSource.getMyOneDriveUrl().then(function(t){return t===e._pageContext.webAbsoluteUrl});this._isCurrentUserODB=function(){return t};return t};t.prototype._getQueryPath=function(e){if(this._urlDataSource.getQueryType(this._urlDataSource.getKeyParams(e))===S.e.SearchOdbScope)return this._urlDataSource.getSearchItemId(e)};t.prototype._getQueryStringWithPathAndFilter=function(e,t,n,r){var i=t;e&&(i+=' ParentLink:"'+n+'*"');return i+(r?" AND "+r:"")};t.prototype._getFilterQuery=function(e){var t=this,n=this._urlDataSource.getKeyParams(e.parentKey),r=this._urlDataSource.getItemTypeFilter(n),i=this._urlDataSource.getUsersFilter(n),s=this._urlDataSource.getDateDurationFilter(n),u=o.e[s],a=this._isOLSQueryEnabled?"modified":"LastModifiedTime";if(u){u=new Date((new Date).getTime()-864e5*X(u)).toISOString();a+=">="}else u=s;var f="";if(i){var l="";i.forEach(function(e){l+=(l?" OR ":"")+'ModifiedBy:"'+e+'"';l+=' OR author:"'+e+'"'});f+=l=(f?" AND ( ":"( ")+l+")"}var c="";if(r&&r.filters.length){for(var h=0,p=r.filters;h<p.length;h++){var d=p[h],v=M.e[d],m=W[v];c+=(c?" OR ":"")+(m=m.map(function(e){return"filetype:"+e+(t._isOLSQueryEnabled?"":"*")})).join(" OR ")}c=(f?" AND ( ":"( ")+c+")"}f+=c;u&&(f+=(f?" AND ":"")+a+'"'+u+'"');return f};t.prototype._getItem=function(e,t){var n,r=this,i=this._urlDataSource.getKeyParams(e.parentKey),s=this._urlDataSource.getItemTypeFilter(i),o=this._urlDataSource.getUsersFilter(i),u=this._urlDataSource.getDateDurationFilter(i),a=this._urlDataSource.getQueryType(i),c=this._urlDataSource.getQueryParamValue(i),h=this._useConversationIdFromInstrumentation&&this._tsInstrumentationProvider.getLastSubmittedConversationId()||this._cvid,p=this._createSearchRoot(e.parentKey,t,c,a,s,u?u.toString():void 0,o),d=(e.requestToken&&JSON.parse(e.requestToken)||{startrow:0}).startrow,v="",m=a===S.e.Discover,g=this._getFilterQuery(e),y={pageSize:e.pageSize,startRow:d,clientFunction:e.isSuggest?b.t:b.e,qosName:e.qosName||"Odb.Item.SearchDataSource.getItem",timeout:6e4,filterQuery:g},w=performance.now(),E=l.e.generate(),T=this._useSubstrateSearchV2?E:void 0;if(m){v=x.e.DISCOVER_URL_MAIN;n=this._searchService.getSearchResultsForUrl(v,"discover");return this._handleSPOSearchResults({searchPromise:n,rootItem:p,isDiscover:m,startRow:d,context:e,requestId:E,scenarioName:"Discover",requestSent:w,conversationId:h})}if(!t||!this._useTsQuery){var N="onedriveweb";if(!t){y.clientType="ODB_Other";N=y.clientType}n=this._searchService.query(c,y);return this._handleSPOSearchResults({searchPromise:n,rootItem:p,isDiscover:m,startRow:d,context:e,requestId:E,scenarioName:N,requestSent:w,conversationId:h})}if(this._useTsQuery&&t){var C=this._getQueryPath(e.parentKey);return this._getTsResponse({query:c,startRow:d,context:e,queryPath:C,conversationId:h,filterQuery:g}).then(function(t){var n,i=[],s=d;try{i=(n=t.EntitySets[0].ResultSets[0]).Results.map(function(e){var t=e.Source;t.TsReferenceId=e.ReferenceId;t.TsLogicalSearchId=T;return t})}catch(e){}n&&(s=d+i.length+(n.MoreResultsAvailable?1:0));return r._handleTsResponse({rootItem:p,response:t,childCount:s,startRow:d,itemsFromServer:i,context:e})}).catch(function(t){var n=performance.now(),i=f.n.isCanceled(t)?408:t.status;r._tsInstrumentationProvider.receivedError(E,n-w,i,!0);if(400===t.status&&t.response&&t.response.error&&"Microsoft.Exchange.Services.Core.Types.ErrorInvalidRequestException"===t.response.error.code){r._useTsQuery=!1;y.qosName+=".BFFallback";var s=r._searchService.query(c,y);return r._handleSPOSearchResults({searchPromise:s,rootItem:p,isDiscover:m,startRow:d,context:e,requestId:E,scenarioName:"onedriveweb",requestSent:w,conversationId:h})}return r._handle3SErrorsEnabled?f.n.wrapError(t):r._handleTsResponse({rootItem:p,response:t.response,childCount:d,startRow:d,itemsFromServer:[],context:e})})}};t.prototype._updateItem=function(e,t,n,r){e.update([new w.t(t).succeed({item:{key:t,name:n,displayName:n,folder:{},type:T.e.Folder,list:{},parentKey:r}})])};t.prototype._updateAllFilesItem=function(e,t){var n,r=this._urlDataSource.getKey(((n={}).view=S.e.Search,n.q=t,n));this._updateItem(e,r,O.e.OdbRootSearchItemName);return r};t.prototype._updateSiteRootItem=function(e,t,n,r){var i,s=this._itemUrlHelper.getItemUrlParts(t);if(!s.normalizedItemUrl||!s.webRelativeItemUrl)return r;var o=s.normalizedItemUrl.replace("/"+s.webRelativeItemUrl,""),u=this._urlDataSource.getKey(((i={}).id=o,i.view=S.e.SearchOdbScope,i.q=n,i));this._updateItem(e,u,O.e.ScopedSiteSearchItemName,r);return u};t.prototype._updateSearchListItems=function(e,t,n,r,i,s,o){for(var u,f,l,c=new a.e(t).segments,h=c.length-1;h>=0;h--){var p=c.slice(0,h+1)?"/"+c.slice(0,h+1).join("/"):void 0,d=h>0&&c.slice(0,h)?"/"+c.slice(0,h).join("/"):void 0,v=c[h],m=this._urlDataSource.getKey(((u={}).id=""+n+p,u.listurl=r,u.view=""+s,u.q=i,u)),g=d?this._urlDataSource.getKey(((f={}).id=""+n+d,f.listurl=r,f.view=""+s,f.q=i,f)):o;this._updateItem(e,m,v,g);h===c.length-1&&(l=m)}return l};t.prototype._getSearchListRootName=function(e,t,n){if(!this._urlDataSource.isItemCrossList(e))return n?O.e.ScopedFolderSearchMyOdb:d.format(O.e.ScopedFolderSearchNotMyOdb,this._pageContext.webTitle);if(this._urlDataSource.isSPSite(e))return O.e.ScopedSiteSearchItemName;var r=t.listRelativeItemUrl?"/"+t.listRelativeItemUrl:"";return!!t.webRelativeItemUrl&&t.webRelativeItemUrl.replace(r,"")||O.e.ScopedDocLibSearchItemName};t.prototype._updateSearchItemParents=function(e,t,n,r,i){var s,o=this._updateAllFilesItem(e,r);if(i===S.e.Search)return o;var u=this._itemUrlHelper.getItemUrlParts(t),a=u.serverRelativeListUrl||u.normalizedItemUrl,f=this._urlDataSource.getKey(((s={}).id=a,s.listurl=u.normalizedListUrl,s.view=i,s.q=r,s)),l=this._getSearchListRootName(t,u,n),c=u.isCrossList?this._updateSiteRootItem(e,t,r,o):o;this._updateItem(e,f,l,c);return u.listRelativeItemUrl?this._updateSearchListItems(e,u.listRelativeItemUrl,u.serverRelativeListUrl,u.normalizedListUrl,r,i,f):f};t.prototype._handleTsResponse=function(e){var t=e.rootItem,n=e.response,r=e.childCount,i=e.startRow,s=e.itemsFromServer,o=e.context,u=new _.e(t.key);h.e(u,t);u.folder={childCount:r};u.isPlaceholder=!1;var a={items:s,itemsFromServer:s,context:o,rootItem:t,children:[],childCount:r,startRow:i,pageImpression:void 0,pageImpressionBlockType:void 0,updatedRootItem:u,actors:void 0,actorItemsFromServer:void 0,getThumbnailByUrl:!1,tsSearchResult:!0,tsTraceId:n&&n.Instrumentation&&n.Instrumentation.TraceId};return this._processItemsFromServer(a)};t.prototype._handleSPOSearchResults=function(e){var t=this,n=e.searchPromise,r=e.rootItem,i=e.isDiscover,s=e.startRow,o=e.context,u=e.requestId,a=e.scenarioName,l=e.requestSent,c=e.conversationId;return n.then(function(e){if(!e)return f.n.wrapError(new Error("Search response null or empty"));var p=performance.now(),d=u;if(t._isNon3SProviderLoggingEnabled){t._tsInstrumentationProvider.receivedResponse(u,p-l,!0,"SPOSearch");t._queueResultsRenderedEvent(u,l,d)}var v=e.Properties,m=e.PrimaryQueryResult&&e.PrimaryQueryResult.RelevantResults,g=m&&m.Properties||{results:[]},y=m&&m.Table.Rows.results||[],b=m&&m.TotalRows||0,w=t._searchRestType.getProperties(v).piPageImpression,E=t._searchRestType.getProperties(g).piPageImpressionBlockType,S=new _.e(r.key);h.e(S,r);S.folder={childCount:b};S.isPlaceholder=!1;for(var T=[],N=[],C=!1,k=x.e.DISCOVER_URL_ACTORS,L=[],A=0;A<y.length;A++){var O=y[A],M=T[A]=t._searchRestType.getProperties(O.Cells);if(i&&M.Edges){var D=M.Edges.filter(function(e){return 1039===e.Properties.Action}),H=D&&D[0]&&D[0].Properties.BlobContent;N[A]=H&&parseInt(H.ActorId,10)||0;M.EditorsCount=H&&parseInt(H.ActorCount,10)||0;if(N[A]){C&&(k+="%20OR%20");k+="workid:"+N[A];C=!0}}if(!i&&t._isNon3SProviderLoggingEnabled){M.TsTraceId=u;M.TsReferenceId=u+"."+A;M.TsLogicalSearchId=d;L.push({ReferenceId:M.TsReferenceId,Type:M.IsContainer||M.ContentTypeId&&F.s(M.ContentTypeId)?P.TsClientDataSourceResultType.folder:P.TsClientDataSourceResultType.file})}}if(t._isNon3SProviderLoggingEnabled&&L.length>0){var B=t._pageContext.systemUserKey,j={traceid:u,userId:B&&B.substring(B.lastIndexOf("|")+1),conversationId:c,logicalId:d,impressionType:P.TsImpressionType.query,scenarioName:a,providerName:"SPOSearch",results:L};t._tsInstrumentationProvider.logClientDataSource(j)}k+="%27";var I={items:y,itemsFromServer:T,context:o,rootItem:r,children:[],childCount:b,startRow:s,pageImpression:w,pageImpressionBlockType:E,updatedRootItem:S,actors:void 0,actorItemsFromServer:void 0,getThumbnailByUrl:!1};return i?(n=t._searchService.getSearchResultsForUrl(k,"discover")).then(function(e){var n=[],r=e&&e.PrimaryQueryResult&&e.PrimaryQueryResult.RelevantResults,i=r&&r.Table&&r.Table.Rows;if(i)for(var s=0,o=i.results;s<o.length;s++){var u=o[s];n.push(t._searchRestType.getProperties(u.Cells))}I.actors=N;I.actorItemsFromServer=n;return t._processItemsFromServer(I)}):t._processItemsFromServer(I)})};t.prototype._processItemsFromServer=function(e){for(var t=e.actorItemsFromServer,n=e.actors,r=e.childCount,i=e.children,s=e.context,o=e.getThumbnailByUrl,u=e.items,a=e.itemsFromServer,f=e.pageImpression,l=e.pageImpressionBlockType,c=e.rootItem,h=e.startRow,p=e.tsSearchResult,d=e.tsTraceId,v=e.updatedRootItem,m=new this._itemTaskObserverType,g=this._urlDataSource.getQueryType(this._urlDataSource.getKeyParams(s.parentKey)),y=0;y<u.length;y++){var b=n&&n[y],w=a[y];if(b)for(var E=0,x=t;E<x.length;E++){var T=x[E];if(T.DocId===b){w.PictureURL=T.PictureURL;w.PreferredName=T.PreferredName;w.PicturePath=T.Path;break}}var N=p?void 0:this._searchService.getSearchInstrumentationUrl({itemFromServer:w,pageImpression:f,pageImpressionBlockType:l,index:y}),C=this._itemResultProcessor.processItemResult(w,{queryType:s.queryType,requestKey:c.key,searchInstrumentationUrl:N,tsTraceId:d,getThumbnailByUrl:o,observer:m,webAbsoluteUrl:this._pageContext.webAbsoluteUrl,calculateDisplayPath:Object(j.isFeatureEnabled)(j.ODBSearchLocationColumn)&&Object(I.e)(g),searchItemFullPath:g===S.e.SearchOdbScope?this._getSearchItemFullPath(s.parentKey):void 0});i.push(C)}m.flush();this._itemsStore.setItem(v);var k=s.needSchema&&this._getSchema(g),L=g!==S.e.Discover;return{item:c,totalChildren:u.length,children:i,nextRequestToken:L&&r>h+u.length?JSON.stringify({startrow:h+u.length}):void 0,schema:k}};t.prototype._getSearchItemFullPath=function(e){return this._itemUrlHelper.getItemUrlParts(e).fullItemUrl};t.prototype._createSearchRoot=function(e,t,n,r,i,s,o){var u,a;if(Object(j.isFeatureEnabled)(j.CSIOdbScopedSearch)&&this._useSubstrateSearchV2){var f=new this._itemTaskObserverType,l=this._updateSearchItemParents(f,e,t,n,r);f.flush();u=this.peekUnwrapObservable(this._itemsStore.getItem(l));r===S.e.SearchOdbScope&&(a=this._getQueryPath(e))}var c={query:n,queryType:r,typeFilter:i,dateFilter:s,authors:o,queryPath:a,listUrl:a?this._itemUrlHelper.getItemUrlParts(e).normalizedListUrl:void 0,currentItem:u},h=y.createSearchRoot({key:this._getSearchRootKey(c),queryType:r,name:this._getSearchRootName(c),isPlaceholder:!0});h.parent=u?u.parent:void 0;this._itemsStore.setItem(h);return h};t.prototype._getSearchRootKey=function(e){var t,n=e.typeFilter,r=n&&n.filters&&n.filters.map(function(e){return M.e[e]}).join(",");return this._urlDataSource.getKey(((t={}).id=e.queryPath,t.listurl=e.listUrl,t.view=e.queryType,t.q=e.query,t.typeFilters=r,t.dateFilter=e.dateFilter,t.userFilters=e.authors&&e.authors.join(","),t))};t.prototype._getSearchRootName=function(e){var t=e.query,n=e.typeFilter,r=e.currentItem;if(r&&r.name)return r.name;var i=d.format(O.e.SearchItemsTitle,t);(n&&n.filters&&n.filters.length||e.dateFilter||e.authors)&&(i=d.format(O.e.FilteredSearchItemsTitle,t));e.queryType===S.e.Discover&&(i=m.e.DiscoverRelevantItems);return i};t.prototype._getSchema=function(e){var t=[this._createColumn("type","",{minWidth:16,width:16,fieldType:i.e.FileIcon}),this._createColumn("name",m.e.NameColumnName,{minWidth:220,width:440,fieldType:i.e.Name})];return t=Object(j.isFeatureEnabled)(j.ODBSearchLocationColumn)&&Object(I.e)(e)?t.concat([this._createColumn("displayPath",m.e.SearchLocationColumnName,{fieldRendererKey:A,width:328}),this._createColumn("editorName",m.e.ModifiedByColumnName,{fieldType:i.e.Text}),this._createColumn("dateModified",m.e.DateModifiedColumnName,{fieldType:i.e.DateTime})]):t.concat([this._createColumn("editorName",m.e.ModifiedByColumnName,{fieldType:i.e.Text}),this._createColumn("dateModified",m.e.DateModifiedColumnName,{fieldType:i.e.DateTime}),this._createColumn("location",m.e.SearchLocationColumnName),this._createColumn("size",m.e.SizeColumnName,{isHtml:!0,fieldType:i.e.FileSize})])};t.prototype._createColumn=function(e,t,n){return Object(r.__assign)({key:e,name:t,minWidth:90,width:130,isVisible:!0,isVisibleMobile:!0,isCollapsable:!0,sortable:!1,isSorted:!1,isIcon:!1,isHtml:!1,isAscending:!0,fieldType:i.e.Text,filterable:!1,groupable:!1,isFocused:this.createObservable(!1)},n||{})};t.prototype._queueResultsRenderedEvent=function(e,t,n){this._logResultsRenderedEnabled&&this._tsInstrumentationProvider.queueResultsRendered(e,t,n)};t.dependencies=Object(r.__assign)(Object(r.__assign)({},u.default.dependencies),{pageContext:s.h,urlDataSource:B.me,itemUrlHelper:N.n,itemsStore:D.t,itemResultProcessor:g.e,isOLSQueryEnabled:b.n.optional,searchService:b.r,tsDataRequestor:E.e,tsInstrumentationProvider:P.resourceKey,itemTaskObserverType:w.r,webDataSource:H.e});return t})(u.default),$=(t.default=V,Object(p.s)("SearchDataSource",V))},3788:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(91),s=n(1113),o=n(104),u=n(17),a=n(3605),f=n(77),l=n(90),c=n(10),h=n(71),p=n(1073),d=(function(){function e(){this._activePromises={}}e.prototype.registerPromise=function(e,t,n,r){this._activePromises[t];this._activePromises[t]={query:e,id:t,completeCallback:n,errorCallback:r,results:[]}};e.prototype.unregisterPromise=function(e){delete this._activePromises[e]};e.prototype.setPromiseData=function(e,t){this._activePromises[e]=t};e.prototype.getPromiseData=function(e){return this._activePromises[e]};e.prototype.getAllPromiseKeys=function(){return Object.keys(this._activePromises)};return e})(),v=n(2381),m=n(1520),g=function(e,t,n,r){this.title=e;this.url=t;this.iconUrl=n;this.type=r||6;this.titleText=m.e.getTextFromHtml(e);this.titleAriaLabel=this.titleText},y=n(333),b=n(129),w=n(34),E=n(1291),S=n(23),x=n(6);n.d(t,"resourceKey",function(){return C});var T=/\.aspx$/gi,N=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});var r=e.call(this,t,n)||this,i=n.searchBehavior,s=void 0===i?{}:i,o=s.supportsResultsWheeling,u=void 0===o||o,a=s.useEnableDynamicGroups,f=void 0!==a&&a,l=s.setPathOnViewChange,c=void 0!==l&&l;r._capabilities={supportsResultsWheeling:u,minimumQueryLength:Object(x.nn)(x.u)?0:2,maxQueryRate:200,showNoResults:!0,showOnlyResults:!1,supportsSearchFiltering:!1};r._engagement=n.engagement;r._listContext=n.listContext;r._navigation=n.navigation;r._pageContext=n.pageContext;r._searchCenterDataSource=n.searchCenterDataSource;r._searchService=n.searchService;r._viewParams=n.viewParams;r._useEnableDynamicGroups=f;r._searchResultType=1;r._pluginToUse="sitequery";r._searchResultType=6;r._sendWarmupCall();c&&r.createBackgroundComputed(function(){var e=r._viewParams();r.setPath(e.id)});return r}t.prototype.getCapabilities=function(){return this._capabilities};t.prototype.getItems=function(e,t){var n=this;void 0===e&&(e="");var r=!1;return new u.n(function(t,s){new u.n(function(e,t){window.require(["odm"],function(t){window.require(["oil.core","oil.p.myprops","sharedwithme","mydocuments","sitequery","oil.p.export"],function(t,r,s,o,u,a){if(!n._initialized){n._oilCore=t;n._pluginService=new t.PluginService({requiresRawData:!0});var f=n._pageContext,l=f.listId,c=void 0===l?"":l,p=f.listUrl,v=void 0===p?"":p,m=f.siteId,g=void 0===m?"":m,y=f.webId,b=void 0===y?"":y,w=f.currentLanguage,E=void 0===w?1033:w;c=c||new h.t(window.location.href.toLowerCase()).getQueryParameter("listid");if(v=v||new h.t(window.location.href.toLowerCase()).getQueryParameter("listurl")){var S=Object(i.n)(n._pageContext);0!==(v=v.substring(S.length)).indexOf("/")&&(v="/"+v);v=n._pageContext.webAbsoluteUrl+v}n._siteQueryPlugin=new u(E,g,b,c,v,n._useEnableDynamicGroups);n._siteQueryPlugin.setPath(n._path);n._siteQueryPlugin.initialize(n._pluginService);new a.ExportPlugin([n._pluginToUse],n._dataDispatcher(),n._errorDispatcher()).initialize(n._pluginService);n._searchPromises=new d;n._initialized=!0}e({oilCore:n._oilCore,pluginService:n._pluginService})})})}).then(function(i){if(!r){var o=new i.oilCore.Query({term:e});n._searchPromises.registerPromise(e,o.getId(),t,s);i.pluginService.setQuery(o)}},function(e){r=!0})},function(){r=!0;n._searchPromises.unregisterPromise(null)})};t.prototype.upscopeSearch=function(e){if(e){var t=this._navigation;this._searchCenterDataSource.getSearchCenterResultsUrl(e).done(function(e){t.navigateTo({url:e,frameId:"_blank"})},function(e){l.e.log(e)})}};t.prototype.searchResultClicked=function(e){};t.prototype.setPath=function(e){if(e){var t=Object(i.n)(this._pageContext);this._path=h.t.concatenate(this._pageContext.webAbsoluteUrl,e.substring(t.length))}else this._path=null;this._siteQueryPlugin&&this._siteQueryPlugin.setPath(this._path)};t.prototype._sendWarmupCall=function(){this._searchService.query("",{pageSize:5,startRow:0,clientFunction:"Warmup",qosName:"Search.SearchDataSource._sendWarmupCall.FAST"})};t.prototype._isOneNoteFolder=function(e){return e.isContainer&&-1!==e.clickurl.toLowerCase().indexOf("wopiframe")&&-1!==e.clickurl.toLowerCase().indexOf("/_layouts/")};t.prototype._dataDispatcher=function(){var e=this,t=!1;if(this.resources.isExposed(w.o)){var n=this._listContext;t=n&&n.isDocLib}return function(n){var r=n.queryId,i=function(n){var i=e._searchPromises.getPromiseData(r);if(i){for(var s=n.length,o=0;o<s;o++){var u,l=n[o];u=t?l.clickurl:l.url;if(l.fileextension&&"one"===l.fileextension.toLowerCase()||e._isOneNoteFolder(l)){u+=-1===u.indexOf("?")?"?":"&";u+="wdsearch="+f.e.encodeURIComponent(i.query)}var c=l.title,h=l.fileextension;if(!t&&"aspx"===h){c=c.replace(T,"");h="listitem"}var p=new g(c,u,l.image,e._searchResultType);p.summary=l.summary;p.showSummary=p.summary&&p.summary.indexOf("<i>")>-1;p.lastModifiedDate=Object(a.t)(l.lastediteddatetime);p.lastModifiedBy=l.rawEditor;p.parentUrl=l.parentlink;S.e.isActivated("928D04F7-D4A8-4594-BD47-B598BC3A4C20","2019/12/31","Fix folder suggestion click with decimal")||(p.isContainer=l.isContainer);var d=E.t(e.resources,h,48);l.isContainer&&!e._isOneNoteFolder(l)?d=E.e(e.resources,"folder",48):l.isContainer&&(d=E.e(e.resources,"onetoc",48));p.iconUrl=d;l.folderbreadcrumb&&l.folderbreadcrumb.length>0&&(p.parentFolder=decodeURI(l.folderbreadcrumb[l.folderbreadcrumb.length-1]));i.results.push(p)}e._engagement.logData({name:"Search.QueryboxNumResults",extraData:{count:s}});e._searchPromises.setPromiseData(r,i)}else;},s={sitequery:i,mydocuments:i};n.processNewData(s);if(n.complete){var o=e._searchPromises.getPromiseData(r);o&&e._searchCenterDataSource.getSearchCenterUrl().done(function(t){var n=e._transferResults(o,t);e._searchPromises.unregisterPromise(r);o.completeCallback(n)},o.errorCallback)}}};t.prototype._errorDispatcher=function(){var e=this;return function(t){console.log("Search error.");var n,r=e._searchPromises.getAllPromiseKeys();for(var i in r){var s=r[i];if(n=e._searchPromises.getPromiseData(s)){e._searchPromises.unregisterPromise(s);if(n.errorCallback){n.errorCallback(t.originalError.message);console.log("Search error details: "+t.originalError.message)}}}}};t.prototype._transferResults=function(e,t){var n;e&&(n={query:e.query,containers:[{results:e.results}],upscopeUnavailable:!e.query||!t});return n};t.dependencies=Object(r.__assign)(Object(r.__assign)({},s.default.dependencies),{engagement:y.e,listContext:w.o.optional,navigation:o.e,pageContext:w.h,searchBehavior:w.p.optional,searchCenterDataSource:p.e,searchService:v.r,viewParams:b.B});return t})(s.default),C=(t.default=N,Object(c.s)("SearchDataSource_1",N))}}]);