(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([["dot_downloaddatasource"],{2099:function(e,t,n){"use strict";n.d(t,"e",function(){return i});var r;(function(e){e[e.absolute=0]="absolute";e[e.relative=1]="relative";e[e.serverRelative=2]="serverRelative"})(r||(r={}));var i=function(e){void 0===e&&(e="");var t=e.indexOf("//"),n=e.indexOf("/"),i=t>-1&&t<=n?t+"//".length:-1,s=(function(e,t){if(t>-1){var n=e.indexOf("/",t);return n>-1?e.slice(0,n):e}return""})(e,i),o=s&&s.slice(i),u=e.slice(s.length),a=s?r.absolute:"/"===u[0]?r.serverRelative:r.relative,f=u.split("/");this.authority=s;this.domain=o;this.format=a;this.path=u;this.segments=f;this.value=e}},3840:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(551),s=n(17),o=n(386),u=n(123),a=n(554),f=n(390),l=n(284),c=n(2842),h=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,{},{pageContext:t})||this;n._itemUrlHelper=new o.e({},{pageContext:t});n._apiUrlHelper=new a.e({},{pageContext:t,itemUrlHelper:n._itemUrlHelper});return n}t.prototype.downloadItems=function(e){var t=e.items[0];return this.getDownloadUrl(t,null,{downloadType:0}).then(function(e){window.location.href=e})};t.prototype.getDownloadUrl=function(e,t,n){var r=this;void 0===n&&(n={});var i=n.downloadType,o=void 0===i?0:i,a=this._itemUrlHelper.getItemUrlParts(e.key);if(1===o)return s.n.resolve(a.fullItemUrl);if(3===o){var h=void 0;h=e.video?24:1;var p=this._apiUrlHelper.build().webByItemUrl(a);return Object(c.e)({dataRequestor:this.dataRequestor,webApiUrl:p,duration:h,serverRelativeItemUrl:a.serverRelativeItemUrl})}if(2===o)return a.isCrossDomain&&n.authToken?this.dataRequestor.getData({url:this._apiUrlHelper.contextInfoUrl(a.fullItemUrl),method:"POST",qosName:"GetContextInfo",authToken:n.authToken}).then(function(e){var t=e.d.GetContextWebInformation.WebFullUrl,n=new f.t({webAbsoluteUrl:t}).build().segment("web").methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:a.serverRelativeItemUrl}).segment("OpenBinaryStream");return s.n.resolve(n.toString())}):s.n.resolve(this.getBinaryStreamApiUrl(a).toString());var d=void 0;if(t||a.siteRelation===u.r.sameSite){var v=void 0;if(t){v=this._itemUrlHelper.getItemUrlParts(t.key).fullItemUrl}else v=this._pageContext.webAbsoluteUrl;d=s.n.resolve(v)}else d=this.dataRequestor.getData({url:this._apiUrlHelper.contextInfoUrl(a.fullItemUrl),method:"POST",qosName:"GetContextInfo"}).then(function(e){return e.d.GetContextWebInformation.WebFullUrl});return d.then(function(e){return e+"/"+r._pageContext.layoutsUrl+"/download.aspx?"+Object(l.e)({SourceUrl:a.serverRelativeItemUrl})})};t.prototype.getBinaryStreamApiUrl=function(e){var t=this._apiUrlHelper.build().webByItemUrl(e);t=(t=t.methodWithAliases("GetFileByServerRelativePath",{DecodedUrl:e.serverRelativeItemUrl})).segment("OpenBinaryStream");var n=this._pageContext.authToken;n&&(t=t.oDataParameter("access_token",n));return t};return t})(i.t),p=n(1433),d=n(104),v=n(10),m=n(480),g=n(1261),y=n(89),b=n(34),w=n(479),E=n(1521),S=n(141),x=n(2099),T=n(425),N=n(51);n.d(t,"resourceKey",function(){return k});var C=(function(){function e(e,t){this._common=new h(t.pageContext);this._dataRequestor=new t.dataRequestorType({});this._graphDataSource=t.graphDataSource;this._itemParentHelper=t.itemParentHelper;this._navigation=t.navigation;this._itemUrlHelper=t.itemUrlHelper;this._identityDataSource=t.identityDataSource}e.prototype.getDownloadUrl=function(e,t){void 0===t&&(t={});var n=Object(p.r)(this._itemParentHelper.getFacetedAncestorOrSelf(e,"subsite"));return this._common.getDownloadUrl(Object(E.n)(e),Object(E.n)(n),t)};e.prototype.getItemContents=function(e){var t=this;return this.getDownloadRequestParameters(e).then(function(e){var n=e.headers,r=n&&n.Authorization,i=r&&r.slice(7);return t._dataRequestor.getData({url:e.url,method:"GET",noRedirect:!0,qosName:"ItemDataSource.getItemContents",responseType:"blob",needsRequestDigest:!1,authToken:i})})};e.prototype.getDownloadRequestParameters=function(e,t){var n=this,r=this._itemUrlHelper.getItemUrlParts(e.key),i=new x.e(r.normalizedItemUrl);return r.isCrossDomain?this._identityDataSource.getSharePointToken(i.authority).then(function(t){var r=t.accessToken;return n.getDownloadUrl(e,{downloadType:2,authToken:r}).then(function(e){return{url:e,headers:{Authorization:"bearer "+r}}})}):this.getDownloadUrl(e,{downloadType:2}).then(function(e){return{url:e,withCredentials:!0}})};e.prototype.downloadItems=function(e){var t=this,n=e.items[0];return(Object(w.isFeatureEnabled)(w.UseVroomDownload)?this._graphDataSource.getDownloadUrl(n,{useDirectEndpoint:!0}):this.getDownloadUrl(n,{downloadType:0})).then(function(e){t._navigation.navigateTo(e)})};e.prototype.isDownloadBlocked=function(e){return!N.e.hasPermission(e.permissions,N.e.openItems)};return e})(),k=(t.default=C,Object(v.s)("DownloadDataSource",C,{dataRequestorType:m.t,graphDataSource:y.y,itemParentHelper:g.e,navigation:d.e,pageContext:b.h,itemUrlHelper:S.n,identityDataSource:T.e}))}}]);